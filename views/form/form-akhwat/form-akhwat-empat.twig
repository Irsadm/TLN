{% extends 'templates/form-template.twig' %}

{% block main %}
    

    <div class="container-fluid" style="width:100%; height:100%">
      <div class="row satu">
         <div class="col-xs-6 col-sm-4"></div>
        <div class="col-xs-6 col-sm-4 text-left">
          <center>
            <div class="error-block hidden">
          <span class="breadcrumb" id="errormessages" style="display: inline; background-color: #f2dede; color: #cc4644; width: 54%; box-shadow: 4px 4px 3px  #C0C0C0; margin-bottom: 13%">Lengkapi data profil Anda !</span>
          </div>
          </center>

                    <!-- form -->
          <form id="myForm">
            <!-- sifat dan karakter -->
             <div>
              <textarea name="karakterDanSifat" id="karakterDanSifat" class="form-control" cols="1" rows="1" placeholder="Karakter dan sifat"></textarea>
            </div> 
            <br>        
            <!-- Target menikah -->

            <div class="form-group jumlah-hafalan">
                <label for="status" class="label-radio">Target menikah</label>
                <span  class="errorRadio hidden"><img class="float-right" style="display: inline; width: 5.7%; margin-top: 0 !important" src="public/assets/images/icon_tanda_seru.png" alt=""></span>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="targetMenikah" id="targetMenikah" value="Secepatnya" >
                    <label class="form-check-label" for="exampleRadios1">
                      Secepatnya
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="targetMenikah" id="targetMenikah" value="1-3 bulan">
                    <label class="form-check-label" for="exampleRadios2">
                      1-3 bulan
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="targetMenikah" id="targetMenikah" value="3-6 bulan">
                    <label class="form-check-label" for="exampleRadios3">
                      3-6 bulan
                    </label>
                  </div> 
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="targetMenikah" id="targetMenikah" value="6-12 bulan">
                    <label class="form-check-label" for="targetMenikah">
                      6-12 bulan
                    </label>
                  </div> 
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="targetMenikah" id="targetMenikah" value="Diatas 12 bulan ">
                    <label class="form-check-label" for="exampleRadios3">
                      Diatas  12 bulan
                    </label>
                  </div>                   
            </div>
              <br>
          <!-- Menikah dengan pria berisitri -->
            <div class="form-group jumlah-hafalan">
                <label for="status" class="label-radio">Menikah dengan pria beristri</label>
                <span  class="errorRadio2 hidden"><img class="float-right" style="display: inline; width: 5.7%; margin-top: 0 !important" src="public/assets/images/icon_tanda_seru.png" alt=""></span>
                <br>
                <span></span><br>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="menikahiPriaYangBeristri" id="menikahiPriaYangBeristri" value="Ya, selama ikhwannya baik agama dan akhlaqnya. Insya Allah saya adalah wanita yang ta'at syari'at." >
                    <label class="form-check-label" for="exampleRadios1">
                      Ya, selama ikhwannya baik agama dan akhlaqnya. Insya Allah saya adalah wanita yang ta'at syari'at.
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="menikahiPriaYangBeristri" id="menikahiPriaYangBeristri" value="Kurang yakin, silakan yakinkan saya">
                    <label class="form-check-label" for="exampleRadios2">
                      Kurang yakin, silakan yakinkan saya
                    </label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="menikahiPriaYangBeristri" id="menikahiPriaYangBeristri" value="Tidak, saya tidak memiliki keinginan untuk menikah dengan pria yang memiliki istri">
                    <label class="form-check-label" for="exampleRadios3">
                      Tidak, saya tidak memiliki keinginan untuk menikah dengan pria yang memiliki istri
                    </label>
                  </div> 
            </div>          

            <!-- Kriteria akhwat yang diharapkan -->
          <div class="kriteria-yang-diharapkan">
            <h6>Kriteria ikhwan yang diharapkan</h6>
          </div>
          <br>
          <!-- umur  -->
          <div class="row umur">
             <div class="col-md-4 umur">
                <input type="number" placeholder="Umur" class="form-control umur" id="minUmur" name="minUmur">
             </div>
              <div class="col-md-4 umur text-center" >
                <h6 style="margin-top: 8%">sampai</h6>
              </div>
               <div class="col-md-4 umur">
                <input type="number" placeholder="Umur" class="form-control umur" id="maxUmur" name="maxUmur">
               </div>

          </div>

          <br>
          <!-- domisili -->
          <div>
            <input type="text" name="domisiliIkhwan" id="domisiliIkhwan" class="form-control" placeholder="Domisili" >
          </div>

          <br>
          <!-- pekerjaan -->
          <div>
            <input type="text" name="pekerjaanIkhwan" id="pekerjaanIkhwan" class="form-control" placeholder="Pekerjaan">
          </div>

          <br>
          <!-- kriteria lainnya -->
             <div>
              <textarea name="kriteriaLainnya" id="kriteriaLainnya" class="form-control" cols="1" rows="1" placeholder=" Kriteria lainnya"></textarea>
            </div> 

          <br>
          <!-- upload foto -->
          <div class="upload-foto">
            <h6></h6>
          </div>

          <div class="upload">
            <div class="row upload">
              <label for="uploadFile" class="labelia">
              <img src="public/assets/images/camera-lit.png"  class="img-circle" alt="">
              <img src="public/assets/images/camera.png" class="img-fluid" alt=""  id="image" for="uploadFile">
              <div class="middle"></div>
              </label>
                  <small class="lineheightwo"><span>Silakan upload foto close up dengan memegang KTP anda
                  di samping anda, foto wajib tampak wajah</span></small>
            </div>
              <input type="file" id="uploadFile" name="uploadFile" style="visibility: hidden">

          </div>
        
           <div class="text-center">
              <button type="submit" class="btn btn-kirim" id="selanjutnya"> Kirim </button>
          </div>

            <br>
          <input type="hidden" id="url" value="{{ base_url() }}">

     
          </form>

        <!-- endform -->

        </div>
        <!-- Optional: clear the XS cols if their content doesn't match in height -->

        <div class="clearfix visible-xs-block"></div>
        <div class="col-xs-6 col-sm-4"></div>
      </div>




    </div>

    {% endblock %}

{% block js %}

 <script>
 var base_url = $('#url').val();
jQuery.validator.setDefaults({
  debug: true,
});

 $(document).ready(function() {
$("input[name='targetMenikah']").click(function(event) {
$('.errorRadio').hide();
  /* Act on the event */
});
$("input[name='menikahiPriaYangBeristri']").click(function(event) {
$('.errorRadio2').hide();
  /* Act on the event */
});
  var validator = $("#myForm").validate({
        errorClass: "errors",
        // errorElement: "input",
        // onfocusout: false,
        rules: {
            karakterDanSifat: {
                "required": true,
                // "email" : true,
            },
            targetMenikah: {
                "required": true,
                // "email" : true,
            },
            menikahiPriaYangBeristri: {
                "required": true,
                // "email" : true,
            },
            minUmur: {
                "required": true
            },
            maxUmur: {
                "required": true
            },
            domisiliIkhwan: {
                "required": true
            },
            pekerjaanIkhwan: {
                "required": true
            },
            kriteriaLainnya: {
                "required": true
            },
            image: {
                "required": true
            },
            
        },
      errorPlacement: function(error, element) {
        if (element.attr("name") == "targetMenikah") {
          $('.errorRadio').removeClass('hidden');
        } else if (element.attr("name") == "menikahiPriaYangBeristri")  {
          $('.errorRadio2').removeClass('hidden');
        } else {
           error.appendTo(element);
         }
        },
        showErrors: function (errorMap, errorList) {

        this.defaultShowErrors(); 

        // toggle the error summary box
        if (this.numberOfInvalids() > 0) {
            $(".error-block").removeClass('hidden');
        } else {
            $("#errormessages").hide();
        }


    },
     submitHandler: function(form) {
      var storage = firebase.storage().ref('profile/akhwat/');
      var currentKey = localStorage.getItem('key');
      // var names;
      var currentName = database.ref('akhwat/' + currentKey);
      currentName.once("value").then(function(snapshot) {
        var names = snapshot.child('nama').val();
        localStorage.setItem('names', names);
      });


      var karakterDanSifat = document.getElementById('karakterDanSifat').value;
      var targetMenikah = document.querySelector('input[name="targetMenikah"]:checked').value;
      var menikahiPriaYangBeristri = document.querySelector('input[name="menikahiPriaYangBeristri"]:checked').value;
      var minUmur = document.getElementById('minUmur').value;
      var maxUmur = document.getElementById('maxUmur').value;
      var domisiliIkhwan = document.getElementById('domisiliIkhwan').value;
      var pekerjaanIkhwan = document.getElementById('pekerjaanIkhwan').value;
      var kriteriaLainnya = document.getElementById('kriteriaLainnya').value;
      var foto = document.getElementById('uploadFile').files[0];

      // console.log(foto);
      var tanggal = new Date();
      var dateFormated = dateFormat(tanggal, "ddmmyyyyhhMMss");
      var names = localStorage.getItem('names');
      var fileName = names + '-' + dateFormated+'.jpg';
      // var fileName = foto.name;
      // var stringFn = toString(fileName);
     var getURL;
     var getUR;
     var uploads;
     var url;
     var downloadUri;

    var newPath = storage.child(fileName);

    var uploadTask = storage.child(fileName).put(foto);
    var ikhwanTable = database.ref().child('akhwat/'+currentKey);

    uploadTask.on(
        firebase.storage.TaskEvent.STATE_CHANGED,
        null,
        null,
        function(snapshot) {
        newPath.getDownloadURL().then(function(downloadURL) {
        ikhwanTable.update({ foto:downloadURL });
        window.location.replace(base_url+'/form-send');
          });
        });


      ikhwanTable.update({
        karakterDanSifat: karakterDanSifat,
        targetMenikah: targetMenikah,
        menikahiPriaYangBeristri: menikahiPriaYangBeristri,
        minUmur: minUmur,
        maxUmur: maxUmur,
        domisiliIkhwan: domisiliIkhwan,
        pekerjaanIkhwan: pekerjaanIkhwan,
        kriteriaLainnya: kriteriaLainnya,
      });

        }


    });
});

    $('#selanjutnya').click(function () {
        $('#myForm').valid(); // run a validity test on the form
    });



</script>

<script type="text/javascript" >
  document.getElementById("uploadFile").onchange = function () {
    var reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("image").src = e.target.result;
    }
    reader.readAsDataURL(this.files[0]);
};

</script>
    
{% endblock %}
